<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>SORA</title>
    <!-- (BOOTSTRAP)CSS only -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-iYQeCzEYFbKjA/T2uDLTpkwGzCiq6soy8tYaI1GyVh/UjpbCx/TYkiZhlZB6+fzT" crossorigin="anonymous" />

    <!--sign in, up form-->
    <!--===============================================================================================-->
    <link rel="stylesheet" type="text/css" href="./vendor/bootstrap/css/bootstrap.min.css" />
    <link rel="stylesheet" type="text/css" href="./fonts/font-awesome-4.7.0/css/font-awesome.min.css" />
    <link rel="stylesheet" type="text/css" href="./fonts/Linearicons-Free-v1.0.0/icon-font.min.css" />

    <link rel="stylesheet" type="text/css" href="./vendor/animate/animate.css" />

    <link rel="stylesheet" type="text/css" href="./vendor/css-hamburgers/hamburgers.min.css" />
    <link rel="stylesheet" type="text/css" href="./vendor/animsition/css/animsition.min.css" />

    <link rel="stylesheet" type="text/css" href="./vendor/daterangepicker/daterangepicker.css" />

    <link rel="stylesheet" type="text/css" href="./css/util.css" />
    <link rel="stylesheet" type="text/css" href="./css/main.css" />
    <!--===============================================================================================-->

    <!-- <link rel="stylesheet" href="./style/bootstrap.min.css" type="text/css" /> -->
    <link rel="stylesheet" href="./style/buttons.css" type="text/css" />
    <link rel="stylesheet" href="./style/style_1.css" type="text/css" />
    <link rel="stylesheet" href="./vendor/select2/select2.min.css" type="text/css" />

    <!--Icecream css/font-->
    <!-- Google Web Fonts -->
    <link rel="preconnect" href="https://fonts.gstatic.com" />
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet" />

    <!-- Font Awesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.10.0/css/all.min.css" rel="stylesheet" />

    <!-- <link rel="stylesheet" href="./css/style.min.css" /> -->
    <link rel="stylesheet" href="./css/style.css" />

    <!--my own css-->
    <link rel="stylesheet" href="./style/style.css" />

    <!-- (BOOTSTRAP)JavaScript Bundle with Popper -->
    <!-- <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.1/dist/js/bootstrap.bundle.min.js" integrity="sha384-u1OknCvxWvY5kfmNBILK2hRnQC3Pr17a+RTT6rIHI7NnikvbZlHgTPOOmMi466C8" crossorigin="anonymous"></script> -->
    <!--jQuery here-->
    <script src="https://code.jquery.com/jquery-3.4.1.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
    <!--Select2-->
    <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
    <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/paginationjs/2.1.5/pagination.css" rel="stylesheet" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/paginationjs/2.1.5/pagination.min.js"></script>

    <!--axios-->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.20.0/axios.js"></script>
</head>

<body>
    <div id="header_container">
        <header class="container-fluid bg-primary py-3 d-none d-md-block">
            <nav class="container">
                <div class="row">
                    <div class="col-md-6 text-center text-lg-left mb-2 mb-lg-0">
                        <div class="d-inline-flex align-items-center">
                            <a class="text-white pr-3" href="">FAQs</a>
                            <span class="text-white">|</span>
                            <a class="text-white px-3" href="">Help</a>
                            <span class="text-white">|</span>
                            <a class="text-white pl-3" href="">Support</a>
                        </div>
                    </div>
                    <div class="col-md-6 text-center text-lg-right">
                        <div class="d-inline-flex align-items-center">
                            <a class="text-white px-3" href="">
                                <i class="fab fa-facebook-f"></i>
                            </a>
                            <a class="text-white px-3" href="">
                                <i class="fab fa-twitter"></i>
                            </a>
                            <a class="text-white px-3" href="">
                                <i class="fab fa-linkedin-in"></i>
                            </a>
                            <a class="text-white px-3" href="">
                                <i class="fab fa-instagram"></i>
                            </a>
                            <a class="text-white pl-3" href="">
                                <i class="fab fa-youtube"></i>
                            </a>
                        </div>
                    </div>
                </div>
            </nav>
        </header>
        <header class="nav_header container-fluid position-relative nav-bar p-0">
            <nav class="outer_nav container-lg position-relative p-0 px-lg-3">
                <nav class="inner_nav navbar navbar-expand-lg bg-white navbar-light shadow p-lg-0">
                    <div class="collapse navbar-collapse justify-content-between" id="navbarCollapse">
                        <div class="navbar-nav ml-auto py-0">
                            <div id="modify_search" class="nav-item nav-link">
                                Modify Search
                            </div>
                            <div id="hide_search" class="nav-item nav-link">
                                Hide Search
                            </div>
                            <div id="div_profile" class="nav-item nav-link">
                                <div>
                                    <button id="trigger_profile">Profile</button>
                                </div>
                            </div>
                        </div>
                        <a href="#" class="navbar-brand mx-5 d-none d-lg-block">
                            <h1 id="sora" class="m-0 display-4 text-primary">
                                <span class="text-secondary"></span>S O R A
                            </h1>
                        </a>
                        <div class="navbar-nav mr-auto py-0">
                            <div id="show_signin" class="nav-item nav-link">
                                <div>
                                    <button id="trigger_show_signin">Sign In</button>
                                </div>
                            </div>
                            <div id="show_signup" class="nav-item nav-link">
                                <div>
                                    <button id="trigger_show_signup">Sign Up</button>
                                </div>
                            </div>
                            <div id="div_signout" class="nav-item nav-link">
                                <button id="trigger_signout">Sign Out</button>
                            </div>
                        </div>
                    </div>
                </nav>

                <div class="container-login100" id="id_container-login100">
                    <div class="wrap-login100 p-t-12 p-b-20">
                        <span class="login100-form-title p-b-41"> Sign In </span>
                        <div class="login100-form validate-form p-b-33 p-t-5">
                            <div class="wrap-input100 validate-input" data-validate="Enter username">
                                <input class="input100" id="signin_input_email" type="text" name="username" placeholder="User Email" />
                                <span class="focus-input100" data-placeholder="&#xe82a;"></span>
                            </div>

                            <div class="wrap-input100 validate-input" data-validate="Enter password">
                                <input class="input100" id="signin_input_password" type="password" name="pass" placeholder="Password" />
                                <span class="focus-input100" data-placeholder="&#xe80f;"></span>
                            </div>

                            <div class="container-login100-form-btn m-t-32">
                                <button class="login100-form-btn" id="trigger_signin">
                    Login
                  </button>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="container-login100" id="id_container-register100">
                    <div class="wrap-login100 p-t-12 p-b-20">
                        <span class="login100-form-title p-b-16"> Sign Up </span>
                        <div class="login100-form validate-form p-b-13 p-t-5">
                            <div class="wrap-input100 validate-input" data-validate="Enter username">
                                <input class="input100" id="signup_input_name" type="text" name="username" placeholder="User Name" />
                                <span class="focus-input100" data-placeholder="&#xe82a;"></span>
                            </div>
                            <div class="wrap-input100 validate-input" data-validate="Enter username">
                                <input class="input100" id="signup_input_email" type="text" name="useremail" placeholder="User Email" />
                                <span class="focus-input100" data-placeholder="&#xe82a;"></span>
                            </div>

                            <div class="wrap-input100 validate-input" data-validate="Enter password">
                                <input class="input100" id="signup_input_password" type="password" name="pass" placeholder="Password" />
                                <span class="focus-input100" data-placeholder="&#xe80f;"></span>
                            </div>

                            <div class="container-login100-form-btn m-t-32">
                                <button class="login100-form-btn" id="trigger_signup">
                    Register
                  </button>
                            </div>
                        </div>
                    </div>
                </div>
            </nav>
        </header>
    </div>
    <div id="root">
        <div id="filters">
            <div id="filters_pleura">
                <div class="filter_box">
                    <label for="id_label_0">
              <div class="filter_title_container">
                <div class="filter_title_text_skin">
                  <p class="filter_title_text">Name</p>
                </div>
              </div>

              <br />
              <select
                class="js-example-basic-multiple"
                name="states[]"
                multiple="multiple"
                id="id_label_0"
              ></select>
            </label>
                </div>
                <div class="filter_box">
                    <label for="id_label_1">
              <div class="filter_title_container">
                <div class="filter_title_text_skin">
                  <p class="filter_title_text">Location</p>
                </div>
              </div>
              <br />
              <select
                class="js-example-basic-multiple"
                name="states[]"
                multiple="multiple"
                id="id_label_1"
              >
                <option value="TPE">台北</option>
                <option value="KAO">高雄</option>
                <option value="NTP">新北</option>
                <option value="TAN">台南</option>
                <option value="HSC">新竹</option>
                <option value="HSC">淡水</option>
                <option value="HSC">文化路</option>
              </select>
            </label>
                </div>
                <div class="filter_box">
                    <label for="id_label_2">
              <div class="filter_title_container">
                <div class="filter_title_text_skin">
                  <p class="filter_title_text">Exotic</p>
                </div>
              </div>
              <br />
              <select
                class="js-example-basic-multiple"
                name="states[]"
                multiple="multiple"
                id="id_label_2"
              >
                <option value="TPE">日式</option>
                <option value="KAO">中式</option>
                <option value="NTP">韓式</option>
                <option value="TAN">美式</option>
                <option value="HSC">泰式</option>
                <option value="HSC">港式</option>
              </select>
            </label>
                </div>
                <div class="filter_box">
                    <label for="id_label_3">
              <div class="filter_title_container">
                <div class="filter_title_text_skin">
                  <p class="filter_title_text">Establishment</p>
                </div>
              </div>
              <br />
              <select
                class="js-example-basic-multiple"
                name="states[]"
                multiple="multiple"
                id="id_label_3"
              >
                <option value="TPE">咖啡廳</option>
                <option value="KAO">居酒屋</option>
                <option value="NTP">餐酒館</option>
                <option value="TAN">酒吧</option>
                <option value="HSC">甜點店</option>
                <option value="HSC">火鍋店</option>
                <option value="TAN">茶館</option>
              </select>
            </label>
                </div>
                <div class="filter_box">
                    <label for="id_label_4">
              <div class="filter_title_container">
                <div class="filter_title_text_skin">
                  <p class="filter_title_text">Name of Dish</p>
                </div>
              </div>
              <br />
              <select
                class="js-example-basic-multiple"
                name="states[]"
                multiple="multiple"
                id="id_label_4"
              >
                <option value="TAN">炸魚薯條</option>
                <option value="TPE">炸豬排</option>
                <option value="KAO">松鼠桂魚</option>
                <option value="NTP">麻婆豆腐</option>
                <option value="TAN">時雨煮</option>
                <option value="HSC">三種起司披薩</option>
                <option value="HSC">上海菜飯</option>
                <option value="HSC">涼拌鮟鱇魚肝</option>
              </select>
            </label>
                </div>
                <div class="filter_box">
                    <label for="id_label_5">
              <div class="filter_title_container">
                <div class="filter_title_text_skin">
                  <p class="filter_title_text">Price Level</p>
                </div>
              </div>
              <br />
              <select
                class="js-example-basic-multiple"
                name="states[]"
                multiple="multiple"
                id="id_label_5"
              >
                <option value="TPE">$</option>
                <option value="KAO">$$</option>
                <option value="NTP">$$$</option>
                <option value="TAN">$$$$</option>
              </select>
            </label>
                </div>
                <div class="filter_box">
                    <label for="id_label_6">
              <div class="filter_title_container">
                <div class="filter_title_text_skin">
                  <p class="filter_title_text">Rating</p>
                </div>
              </div>
              <br />
              <select
                class="js-example-basic-multiple"
                name="states[]"
                multiple="multiple"
                id="id_label_6"
              >
                <option value="TPE">1</option>
                <option value="KAO">2</option>
                <option value="NTP">3</option>
                <option value="TAN">4</option>
                <option value="HSC">4.5</option>
              </select>
            </label>
                </div>
                <div class="filter_box">
                    <label for="id_label_7">
              <div class="filter_title_container">
                <div class="filter_title_text_skin">
                  <p class="filter_title_text">Timeline</p>
                </div>
              </div>
              <br />
              <select
                class="js-example-basic-multiple"
                name="states[]"
                multiple="multiple"
                id="id_label_7"
              >
                <option value="TPE">早餐</option>
                <option value="KAO">早午餐</option>
                <option value="NTP">午餐</option>
                <option value="TAN">下午茶</option>
                <option value="HSC">晚餐</option>
              </select>
            </label>
                </div>
                <div class="filter_box">
                    <label for="id_label_8">
              <div class="filter_title_container">
                <div class="filter_title_text_skin">
                  <p class="filter_title_text">Amenities / Services</p>
                </div>
              </div>
              <br />
              <select
                class="js-example-basic-multiple"
                name="states[]"
                multiple="multiple"
                id="id_label_8"
              >
                <option value="TPE">外帶</option>
                <option value="KAO">外送</option>
                <option value="NTP">寵物友善</option>
                <option value="TAN">兒童座椅</option>
                <option value="HSC">停車場</option>
                <option value="PLUG">插座</option>
                <option value="PLUG">吃到飽</option>
                <option value="PLUG">預約制</option>
              </select>
            </label>
                </div>
                <div class="filter_box">
                    <label for="id_label_9">
              <div class="filter_title_container">
                <div class="filter_title_text_skin">
                  <p class="filter_title_text">Opening</p>
                </div>
              </div>
              <br />
              <select
                class="js-example-basic-single"
                name="states"
                id="id_label_9"
              >
                <option value="TRUE">是</option>
                <option value="FALSE">否</option>
              </select>
            </label>
                </div>
                <div id="selected_fire_container">
                    <!-- <button id="selected_fire">SORA!!</button> -->
                    <button type="button" id="selected_fire" class="btn btn-warning btn-lg">
              S O R A
            </button>
                </div>
            </div>
        </div>
    </div>
    <!--Bootstrap-->
    <!--===============================================================================================-->
    <script src="./vendor/animsition/js/animsition.min.js"></script>
    <script src="./vendor/bootstrap/js/popper.js"></script>
    <script src="./vendor/daterangepicker/moment.min.js"></script>
    <script src="./vendor/daterangepicker/daterangepicker.js"></script>
    <script src="./vendor/countdowntime/countdowntime.js"></script>
    <script src="./js/main.js"></script>

    <!--Icecream-->
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.bundle.min.js"></script>
    <script src="./lib/easing/easing.min.js"></script>
    <script src="./lib/waypoints/waypoints.min.js"></script>
    <script src="./lib/owlcarousel/owl.carousel.min.js"></script>
    <script src="./lib/isotope/isotope.pkgd.min.js"></script>
    <script src="./lib/lightbox/js/lightbox.min.js"></script>

    <!-- Contact Javascript File -->
    <script src="./mail/jqBootstrapValidation.min.js"></script>
    <script src="./mail/contact.js"></script>

    <!-- Template Javascript -->
    <script src="./js/main_ice.js"></script>

    <script>
        document.body.onkeypress = function() {
            document.body.classList.toggle("liked");
        };
    </script>
    <script>
        let cnt = 0;
        let hits_arr = [];
        let page_len = 0;
        let personal_token;
        let friends_set = new Set(),
            favorite_set = new Set();
        const MAIN_HOST = "https://chipmunk.vip";
        let _stamp = Date.now();
        const LATENCY = 900000;
        let click_cnt = 0,
            time_window = Date.now();
        let display_google_reviews = false;
        const opening_dict = {
            星期一: 1,
            星期二: 2,
            星期三: 3,
            星期四: 4,
            星期五: 5,
            星期六: 6,
            星期日: 0,
        };
        const week_day_dict = {
            星期一: "MON",
            星期二: "TUE",
            星期三: "WED",
            星期四: "THR",
            星期五: "FRI",
            星期六: "SAT",
            星期日: "SUN",
        };

        // QQQ.目前是寫死的，不過之後要看看要不要改。畢竟feature可能會改。
        // 不過這次專案就這樣也可以

        const lorum_ipsum =
            "Lorem ipsum dolor sit amet, consectetur adipiscing elit. Aenean ipsum felis, lacinia eget sollicitudin id, sollicitudin ac massa. Vestibulum ac diam eu turpis sagittis ultrices eu et sem. Aliquam a congue metus, nec pulvinar felis. Curabitur sed gravida augue, vel fermentum leo. Etiam auctor consequat fermentum. Ut quis aliquam dolor, eu euismod enim. Suspendisse varius, mi in condimentum volutpat, felis arcu auctor tellus, a commodo erat ante et velit. Curabitur a rutrum tortor. Class aptent taciti sociosqu ad litora torquent per conubia nostra, per inceptos himenaeos. Cras elementum gravida laoreet. Etiam tempus sollicitudin nibh, pharetra volutpat magna. Proin fermentum, dolor ac congue molestie, ante velit maximus velit, eget aliquam magna mauris auctor purus. Fusce maximus quis tellus id lacinia.";
        const default_restaurant_list_img_path =
            "./images/restaurant_list_default";
        const default_restaurant_detail_img_path =
            "./images/restaurant_detail_default.jpg";

        const profile_img_default_base64_src = `iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAAABHNCSV
                  QICAgIfAhkiAAAAAlwSFlzAAABuwAAAbsBOuzj4gAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYX
                  BlLm9yZ5vuPBoAAAnxSURBVHic7ZtrbBTXFcd/d2Z2bS9ePzHGy8PBJqYYm4QYQhMR0ZikIpVJpC
                  BAbaVGJAppiFS1iRCq+gHxoaqiqEWqVCo1SqKoVSSCGpWEKm1RnJpAEkIwriGGEHCwgbWxjd/24s
                  fO7YfZ9c6sd727M7skH/KXkLln7/3PuWfu49xzzwgpJZnE/v+Sq45Rr0KFK4hPAZ8axKeBT5H4NB
                  1UiV+V+NUgfhX8Lh2/ImkPZtG4bRujmdRPZMIALzayKGuKLS54XNWpVyVZqoRQZ1HDf80yk9wkm1
                  B1Gl2Sd10K79X/jBvp1jVtBnjuKB6Ph92aZIeiU6dKhBavs8kbAFUHzfi/VHTOqHDIG+Rg3S7G06
                  G3YwNsP4w6v4SdmmC/GsRn6Uh6DRBpp+PXYN+1Qt7Yto2gE/0VJ413naChsJRWBK8i8TnhShE+JK
                  /edYvW5j/R4ITI1gj46ceUu+FNVWdjzLed+RFgkWk6TS7BUytfoCPVvqQ8An5yig0KnEayMdW2mY
                  IUbJSS05f+yIZU26Y0Anac4mlV8mdVxx39VpIdAXluKC+GvBzwZoMiIRCAwBj0dMNkIPURYHrWpK
                  bz/PJf8npaDbD9MKpeziuq5FcJFIgrqy2DdXeBr3DuZ/X1weWL4L9qywBh2YGKxewhiQUyoQG2H0
                  adWsbfVckTKSgwI8vToGEVfG9hQjtb4O+E1lMwPW7LAGiSI0uXsDWRERKuAeOVvAI8kZr6BlaVwu
                  6HUu88gG8pPLwFysrtPBkkPHGjk1cS1ZtzBPzoLE+rOq/ZeQOPLYcfLJvNOTAK3QPQOwB9/Ua7BQ
                  VQUgglxZDnnd2mvRWunEnt+WGZpvNM6Z74a0JcAzz6Pza4dD6IteAlUqAyD36+FoSI8E1OQ1MbnL
                  s69za4ohLWrAFNi7SVEj5/H0a6UjeAqjOp6mwq2cuJWP2MOQU2naVckbwDuONZLh5cKmyvsXa+sx
                  9e+whaktilL1+G//wT+noiMiGg5iFQtfjt5oAbwTuDvyfmZIq9Bqi8CZTYeVrDcijOiZR7R+Gtz2
                  AwBc99bBROfgAjQxFZjhcq19nRCICS4BRvxvphlgEePk+DsOnkLM2DBxdHyrqEf7TCtJ46VzAIzS
                  eN4R/G4mrw2notIAQbR3432222GGD7YVQpedneI6CuFEwjn+Pt4B+KWz0hBm/BV61WWWmlfT4JL3
                  MY1SyzGKC7mp1Atd0H1ES9nU877TJFcPWCtVxsc1sMoXr8K3aaBTMGWHsGj9TZb5c51wVF2ZHyYA
                  DGJ+2yRTA5AQFTTCjbC67s+PUTQcJ+9uMJl2cM4M5hN8L+kTY/y1q+MWyXaTaGb1nL7nmO6HwBjd
                  3hQmQKCHY4Yc2L2jC70hjJG+m3lt2e2PWShZCRvioAD15iEZI6J6S3p63lvKzY9ewgK+qNTzufWn
                  WB37IIQgYITrMF6wKeMgajlFqc54TNivxia3lyzDGl0HS2QMgAQvC4U8ahCZgwnbtKvaA5CrgZUF
                  Twmo7QwSmYTEM4VGL0WalpI1dCvVNCXcJF02KlCqgojl8/WcwvA2EyZP91kDYcq2gIqGc/uUqOSj
                  2Qlhnb2mstN6wEtz3/HQDNBbXrrbK+q/b5opAVhHpF16lIF2NLD1wzbX8FObB5pX2+mrWQkxspj/
                  RB79f2+aIhFCoUhfSFs3UJh9qsvv+axbDWhvdWsQLKl5u4g9B2PD3DfwYSnyIdOD+x0D0Gx65YZZ
                  tXwY77wZsTu40ZHg88VA/3Rp38rrTA2ED69AzBp5HGERDG8Q6oXQCL8yOyihLYuRGa26H7lhENCu
                  /nWW5YUAilRbByBbhcVr6hPug45/AWJwZEpgygS/hrC2ythirTASnLBQ+siJSHQt5ifi5x0XMdvo
                  g6FqcLMlMGABiZgL81Q10ZbK6GrBi7wVwdn5qC86fhxleh0FYmlAwZIKNouQEdfdBQa0yDZNDdBW
                  c/MTy+DHV8BhrgB1YkqugEw7fh0GewwANVpVA+31gQc0OL4ngAxsbhZjf4r8P4YCi4mUmlDPjviA
                  HC6B+F0yPQfCl+VFiVxlu5ExAmA9wx5HvA6wZvFnjcxt3g1ARMBGBizBr8yDQk+DUhM2sAIWBZEa
                  xcaAz/3ATRnEAA/NegqxP6uzOpGQB+TQd/uvfXMKpK4NG7jZNhssjJgcoq49/wAFxshv5rGVJQ4N
                  cUhXbS6V5iDPEf10JlkTOevEK4fxPc6oLzTRB0HgewQOq0a4EgjfMEE6TpRLjICztXQ0GcoT40Dn
                  1DcGsQhkeNRa9gHhQXQFEB5MaI9xWXwfotcO4YjPelQ0sAJlRo1M5XM/r9CzQCjzllrCyA5+4xrs
                  fMuD0Fx7+EC9eMgMZcd4PZGlSWQ8094DLFGbPnwX0NcO5fMJqGVUtCI/sYVQCk5F2nhMXZsLPW2n
                  kJnL0OB5vgTIdxQZoIU1Nw+RL8+wh0XLb+pmqw6hEjNO4UAqPPSoj4vZC+tuBWYFctzDMdYiam4b
                  VT8O45e/cDkxPQ8gmcfB+mpyJyVzZUbwbFmbMgpxXeg5ABPq7iBoIzdtkeWQJlprkrgcPnoXPQkZ
                  IADPRA60dWmacQylY7oj2T8xsj6zSyA0oO2WHyugwDmHHsCrT1xK5vBz2dcOWsVea7F1xJxBdiQY
                  pIX2cMMBngIDacoh8ugWzTvP+iDxrb7Sk2F9pboM9016i6YOG9tqj8OdMcDBdmDPB5HeNCYV+qbG
                  ujTngfXnWwmCRAR9RNcZGNm2IB+9gXyTO2OIEL23gDaEuWbMk8KDJ5DwO3ocPBdXgiDN2ECdNZwZ
                  0LOfNTomjz3M0bZoHFAG9vIygEe5Nlq43K+Tt7M3NvP4yeqOmVvzT5tgL2RqfNzdpMPqzh6KZWmp
                  JJhS2O8va+HjKuyBU5+4irhJKWlHiykFwJOUcKUYlZEhQdhm9an+lO0ieQkibvrzkaLY+9mwZ5Cs
                  FpEuQJ5UfdCD/jbGuyBVdyV+W9qounYv0Q8yD4wRo6dMGTwJwujPdORS7mgJY4WWISyZMFL8XOJI
                  97Ej52DyeA5+divpDBBS9ZDF+f+3cBz8fLEYQkcoUbmvmDS48kSZsTFbMFPDAfqvIMSwpp3LGH/8
                  7ITPJY9eLJlbnqSRjrgsEvQUzHTZQ8sOglXpyrfwkHsecKe6aWUUGMfOEpHU52w6dd3+wHE7GCpw
                  KOLFrKnkT9SxgMensbQdfXbEVyIFHdbxEOJJMpDt/ABxMZGQGmvOBUP5hIKRx4aD2vI9gE9CasfI
                  choFeBTal0HmzcN761nhM6rEPQlGrbTEFImoRgXdUv4q/28ds6uHXcdYIGofOyKqn+hqZAmxpk73
                  0vzPbwkoWjiPhfNnB04CarkTyLuKMXLH4Ez14tZrWTzsN3n85+9/F0Rgxgxrf98/n/A88Hx3MMwl
                  6AAAAAAElFTkSuQmCC`;
        const profile_img_default_base64 = `data:image/png;base64,${profile_img_default_base64_src}`;

        const user_features = new Set([
            "name",
            "level",
            "birthday",
            "birthplace",
            "hobbies",
            "occupation",
            "age",
            "gender",
        ]);

        const attach_post_to_container = (
            container_id,
            name,
            title,
            content,
            time,
            rating
        ) => {
            const fresh_review_block = $("<div>").attr({
                class: "native_review_block",
            });

            const fresh_review_head = $("<div>").attr({
                class: "fresh_review_head",
            });
            const fresh_review_neck = $("<div>").attr({
                class: "fresh_review_neck",
            });
            const fresh_review_head_neck = $("<div>").attr({
                class: "fresh_review_head_neck",
            });
            const fresh_review_body = $("<div>").attr({
                class: "fresh_review_body",
            });
            fresh_review_block.append(fresh_review_head_neck);
            fresh_review_head_neck.append(fresh_review_head);
            fresh_review_head_neck.append(fresh_review_neck);
            fresh_review_block.append(fresh_review_body);

            // user
            let review_user_avatar_div = $("<div>").attr({
                class: "review_user_avatar_div",
            });
            const default_avatar = $(`<img src="${profile_img_default_base64}">`);
            review_user_avatar_div.append(default_avatar);

            let review_user_name_date_div = $("<div>").attr({
                class: "review_user_name_date_div",
            });
            let review_user_name_div = $("<div>").attr({
                class: "review_user_name_div",
            });

            let review_user_name_p = $("<p>");
            review_user_name_p.text(name);

            review_user_name_date_div.append(review_user_name_div);
            review_user_name_div.append(review_user_name_p);
            // time
            let review_time_div = $("<div>").attr({
                class: "native_review_time",
            });
            let review_time_p = $("<p>");
            review_time_p.text(new Date(time).toDateString());
            review_time_div.append(review_time_p);
            review_user_name_date_div.append(review_time_div);
            //
            let review_user_div = $("<div>").attr({
                class: "review_user_div",
            });
            review_user_div.append(review_user_avatar_div);
            review_user_div.append(review_user_name_date_div);
            fresh_review_head.append(review_user_div);

            // title
            let review_title_div = $("<div>").attr({
                class: "native_review_title",
            });
            let review_title_h5 = $("<h5>");
            review_title_h5.text(title);
            review_title_div.append(review_title_h5);
            fresh_review_head.append(review_title_div);

            //rating
            const review_rating_div = $("<div>").attr({
                class: "native_review_rating",
            });
            // const rating_img = $("<img>").attr({
            //     src: "./images/5star.jpg",
            // });
            const rating_container = $("<div>").attr({
                class: "native_rating_container",
            });
            // const star_glow_icon = $("<img>").attr({
            //     src: "./icon/star_glow.png",
            // });
            // const star_dim_icon = $("<img>").attr({
            //     src: "./icon/star_dimmed.png",
            // });
            console.log("rating: ", rating);
            for (let i_star = 0; i_star < 5; i_star++) {
                if (i_star < rating) {
                    rating_container.append(
                        $("<img>").attr({
                            src: "./icon/star_glow.png",
                        })
                    );
                    //console.log("+1");
                } else {
                    rating_container.append(
                        $("<img>").attr({
                            src: "./icon/star_dimmed.png",
                        })
                    );
                    //console.log("+0");
                }
            }

            review_rating_div.append(rating_container);
            fresh_review_neck.append(review_rating_div);

            // content
            let review_content_div = $("<div>").attr({
                class: "native_review_content",
            });
            let review_content_span = $("<span>");
            review_content_span.text(content);
            review_content_div.append(review_content_span);
            fresh_review_body.append(review_content_div);
            //
            $(`#${container_id}`).append(fresh_review_block);
            return fresh_review_block;
        };

        $(document).ready(() => {
            $(".js-example-basic-multiple").select2({
                tags: true,
            });
        });
        console.log("initial setting start...");

        $("#hide_search").hide();
        $("#modify_search").hide();
        $("#id_container-login100").hide();
        $("#id_container-register100").hide();

        const filter_toggle = 0;
        $(document).on(".filter_title_container", "click", (event) => {});

        // INITIAL CHECK: if token is there
        const token = localStorage.getItem("jwt");
        // check token and renew it if present
        if (!token) {
            $("#div_signout").hide();
            $("#div_profile").hide();
            $("#show_signin").show();
            $("#show_signup").show();
        } else {
            axios
                .post(
                    `${MAIN_HOST}/verify_token`, {}, {
                        headers: {
                            "Access-Control-Allow-Origin": "*",
                            "Content-Type": "application/json",
                            Authorization: `Bearer ${token}`,
                        },
                    }
                )
                .then((response) => {
                    if (response.data.new_token) {
                        // there is a valid token
                        localStorage.setItem("jwt", response.data.new_token);
                        personal_token = response.data.personal_token;
                        // personal_token is email
                        // successfully signed in initially
                        $("#show_signin").hide();
                        $("#show_signup").hide();
                        $("#div_signout").show();
                        console.log("valid token present; signed in currently.");
                    } else {
                        // token is invalid
                        console.log(JSON.stringify(response.data.state));
                        $("#div_signout").hide();
                        $("#div_profile").hide();
                        $("#show_signin").show();
                        $("#show_signup").show();
                    }
                })
                .catch((err) => {
                    // other error
                    console.log("error: ", err);
                    $("#div_signout").hide();
                    $("#div_profile").hide();
                    $("#show_signin").show();
                    $("#show_signup").show();
                });
        }

        const obj = axios
            .get(`${MAIN_HOST}/profile`, {
                headers: {
                    "Access-Control-Allow-Origin": "*",
                    "Content-Type": "application/json",
                    Authorization: `Bearer ${token}`,
                },
            })
            .then(
                (response) => {
                    const req_status = response.data.state;
                    console.log("response.data:", response.data);
                    // debugging msg
                    // profile_data contains only data decoded from token
                    const profile_data = response.data.profile;
                    // if not profile_data應該要處理一下，雖然目前應該不會發生
                    // let div_profile = $("<div></div>").attr({
                    //     id: "profile_container",
                    // });
                    // // friend list
                    // let div_friend = $("<div></div>").attr({
                    //     id: "friend_container",
                    // });
                    // // favorite restaurants/collection
                    // let div_favorite = $("<div></div>").attr({
                    //     id: "favorite_container",
                    // });
                    // $("#root").append(div_profile);
                    // $("#root").append(div_friend);
                    // $("#root").append(div_favorite);

                    //set personal token for more purposes
                    personal_token = profile_data["email"] ? profile_data["email"] : "";
                    // display available features of user

                    // for (k of Object.keys(profile_data)) {
                    // 這2個keys暫時不處理；放到其他按鈕來處理
                    //     if (k === "friends") {
                    //         continue;
                    //     } else if (k === "favorite") {
                    //         continue;
                    //     }
                    //     let profile_key = $("<p></p>").attr({
                    //         id: `profile_div_${k}`,
                    //     });
                    //     profile_key.html(`${k}: ${profile_data[k]}`);
                    //     div_profile.append(profile_key);
                    // }
                    // div_friend.append(
                    //     $("<button id='show_friend'>美食同好</button>")
                    // );
                    // div_favorite.append(
                    //     $("<button id='show_favorite'>口袋名單</button>")
                    // );
                    // get friend and favorite here
                    // UPDATE: friend done;
                    // should have token here
                    let email;
                    try {
                        email = personal_token.replace(".", "%2E");
                    } catch (err) {
                        console.log("error occurred when urlencoding email:", err);
                        return;
                    }

                    // get friend list here
                    axios
                        .get(`${MAIN_HOST}/friends?email=${email}`, {
                            headers: {
                                "Access-Control-Allow-Origin": "*",
                                "Content-Type": "application/json",
                                Authorization: `Bearer ${token}`,
                            },
                        })
                        .then((response) => {
                            try {
                                const data = response.data;
                                for (d of data) {
                                    const fid = d._id ? d._id : -1;
                                    friends_set.add(fid);
                                }
                                // $(".friend_box").hide();
                            } catch (err) {
                                console.log("err in expanding friend data: ", err);
                            }
                        })
                        .catch((err) => {
                            console.log("err:", err);
                        });

                    // get favorite list here
                    axios
                        .get(`${MAIN_HOST}/favorite?email=${email}`, {
                            headers: {
                                "Access-Control-Allow-Origin": "*",
                                "Content-Type": "application/json",
                                Authorization: `Bearer ${token}`,
                            },
                        })
                        .then((response) => {
                            try {
                                const data = response.data.favorite;
                                //console.log("response data: ", data);
                                // const favorite = $("<div></div>").attr({
                                //     class: "favorite_box",
                                // });
                                // $("#favorite_container").append(favorite);

                                for (d of data) {
                                    const item = d.data;

                                    // const name = item.rname ? item.rname : "ANONYMOUS_UNIT";
                                    const rid = item.rid ? item.rid : -1;
                                    //console.log("rid: ", rid);
                                    // console.log(
                                    //     "favorite_set has rid?",
                                    //     favorite_set.has(rid) ? true : false
                                    // );
                                    //console.log("favorite_set: ", favorite_set);
                                    favorite_set.add(rid);
                                    // const favorite_case = $("<div></div>").attr({
                                    //     class: "favorite_case",
                                    // });
                                    // favorite.append(favorite_case);
                                    // const name_box = $("<div></div>");
                                    // const name_p = $("<p></p>").text(`name:${name}`);
                                    // name_box.append(name_p);
                                    // favorite_case.append(name_box);
                                }
                                // $(".favorite_box").hide();
                            } catch (err) {
                                console.log("err in expanding favorite data: ", err);
                            }
                            // display favorite restaurants
                        })
                        .catch((err) => {
                            // display error
                            console.log("error in get favorite: ", err);
                        });
                }
                // verify successful
            )
            .catch((err) => {
                // verify failed
            });

        ////
        $("#sora").click((event) => {
            //console.log("SORA reload");
            location.reload();
        });

        $("#trigger_signup").click((event) => {
            console.log("pressed sign up");
            $("#id_container-register100").hide();
            axios
                .post(
                    `${MAIN_HOST}/signup`, {
                        name: $("#signup_input_name").val(),
                        email: $("#signup_input_email").val(),
                        password: $("#signup_input_password").val(),
                    }, {
                        headers: {
                            "Access-Control-Allow-Origin": "*",
                            "Content-Type": "application/json",
                        },
                    }
                )
                .then((response) => {
                    //console.log(JSON.stringify(response.data.state));
                    const token = response.data.token;
                    if (!token) {
                        //failed signing up
                        alert("註冊失敗: 沒有取得JWT");
                        console.log("error: did not receive token");
                        //console.log("response.data: ", response.data);
                    } else {
                        //signed up successfully
                        const token = response.data.token;
                        localStorage.setItem("jwt", token);
                        //$("#div_signup").hide();
                        //$("#div_signin").hide();
                        $("#show_signin").hide();
                        $("#show_signup").hide();
                        $("#div_signout").show();
                        $("#div_profile").show();
                    }
                })
                .catch((err) => {
                    //failed signing up
                    alert("註冊失敗: 其他原因");
                    $("#id_container-register100").hide();

                    console.log("An error occurred:", err);
                })
                .finally(() => {
                    $("#signup_input_name").val("");
                    $("#signup_input_email").val("");
                    $("#signup_input_password").val("");
                    console.log("finally of signing up");
                });
        });

        $("#trigger_signin").click((event) => {
            console.log("pressed sign in");
            $("#id_container-login100").hide();
            axios
                .post(
                    `${MAIN_HOST}/signin`, {
                        email: $("#signin_input_email").val(),
                        password: $("#signin_input_password").val(),
                    }, {
                        headers: {
                            "Access-Control-Allow-Origin": "*",
                            "Content-Type": "application/json",
                        },
                    }
                )
                .then((response) => {
                    // receive JWT; signed in successfully
                    //console.log("response.data: ", response.data);
                    if (!response.data.token) {
                        // failed signing in
                        // QQQ. 後端要再確認一下：這邊註冊跟登入前端流程一樣，失敗時，alert結果卻不同。why?
                        alert("登入失敗: 未取得JWT");
                    } else {
                        // 成功登入
                        $("#trigger_profile").trigger("click");
                        const token = response.data.token;
                        localStorage.setItem("jwt", token);
                        $("#show_signin").hide();
                        $("#show_signup").hide();
                        $("#div_signout").show();
                        $("#div_profile").show();
                    }
                    console.log(JSON.stringify(response.data.state));
                })
                .catch((err) => {
                    console.log("An error occurred:", err);
                    alert("登入失敗: 其他原因");
                })
                .finally(() => {
                    $("#signin_input_name").val("");
                    $("#signin_input_email").val("");
                    $("#signin_input_password").val("");
                    console.log("finally");
                });
        });

        $("#trigger_signout").click((event) => {
            console.log("press sign out");
            localStorage.removeItem("jwt");
            location.reload();

            // $("#show_signin").show();
            // $("#show_signup").show();
            // $("#profile_skin").remove();
            // $("#div_signout").hide();
            // $("#div_profile").hide();
            // $("#filters").show();
            // personal_token = "";
        });

        // (solved)QQQ.你拿profile為什麼要打兩次API? 應該一次就夠了
        // QQQ. 在結果頁登入的話，favorite_set跟收藏燈號的狀況要更新
        $("#trigger_profile").click(async(event) => {
            console.log("trigger profile");
            // if (0) {
            //     //  時間之內
            //     // Date.now() - _stamp < LATENCY
            //     $("#profile_container").show();
            //     $("#friend_container").show();
            //     $("#favorite_container").show();
            //     _stamp = Date.now();
            //     return;
            // }
            $("#profile_skin").remove();
            // $("#profile_container").remove();
            // $("#friend_container").remove();
            // $("#favorite_container").remove();

            const token = localStorage.getItem("jwt");
            let profile_flag = 0;

            // verify token first and set flag
            profile_flag = await (async function() {
                if (!token) {
                    $("#div_signout").hide();
                    return 0;
                }
                return axios
                    .post(
                        `${MAIN_HOST}/verify_token`, {}, {
                            headers: {
                                "Access-Control-Allow-Origin": "*",
                                "Content-Type": "application/json",
                                Authorization: `Bearer ${token}`,
                            },
                        }
                    )
                    .then((response) => {
                        if (response.data.new_token) {
                            // successfully verifying token
                            // do we really need to renew token everytime?
                            // considering add parameter(s) to verify_token API
                            // to judge if we would renew the token when verifying.
                            localStorage.setItem("jwt", response.data.new_token);
                            personal_token = response.data.personal_token;
                            // authenticated; positive
                            //$("#div_signup").hide();
                            //$("#div_signin").hide();
                            //$("#id_container-login100").hide();
                            $("#show_signin").hide();
                            $("#show_signup").hide();
                            $("#div_signout").show();
                            //$("#div_signout").show();
                            //display profile for user
                            console.log("status checked, signed in");
                            return 1;
                        } else {
                            // authenticated; negative
                            console.log(JSON.stringify(response.data.state));
                            $("#show_signup").show();
                            $("#show_signin").show();
                            $("#div_signout").hide();
                            return 0;
                        }
                    })
                    .catch((err) => {
                        // authenticated; negative
                        console.log("error: ", err);
                        console.log(JSON.stringify(response.data.state));
                        $("#show_signup").show();
                        $("#show_signin").show();
                        $("#div_signout").hide();
                        return 0;
                    });
            })();
            // status check
            // console.log("profile_flag: ", profile_flag);
            if (profile_flag === 0) {
                // failed
            } else {
                // profile_flag === 1
                // SQQQ.你也知道verify_token沒用，那第一次應該也不用打了
                // R. 不過POST verify_token才會有renewed token, GET profile是不會拿到新token的
                // 這樣或許比較好
                const obj = axios
                    .get(`${MAIN_HOST}/profile`, {
                        headers: {
                            "Access-Control-Allow-Origin": "*",
                            "Content-Type": "application/json",
                            Authorization: `Bearer ${token}`,
                        },
                    })
                    .then(
                        (response) => {
                            $("#filters").hide();
                            $("#modify_search").show();
                            $("#restaurant_skin").hide();
                            $("#detail_container").remove();
                            // $("#restaurant_container").hide();
                            // $("#pagination").hide();

                            $("#detail_box").hide();
                            const req_status = response.data.state;
                            console.log("response.data:", response.data);
                            console.log("response:", response);
                            // debugging msg
                            console.log("Get profile status:", req_status);
                            // profile_data contains only data decoded from token
                            const profile_data = response.data.profile;
                            // if not profile_data應該要處理一下，雖然目前應該不會發生
                            let div_profile_skin = $("<div></div>").attr({
                                id: "profile_skin",
                            });
                            let div_profile = $("<div></div>").attr({
                                id: "profile_container",
                            });
                            // friend list
                            let div_friend = $("<div></div>").attr({
                                id: "friend_container",
                            });
                            // favorite restaurants/collection
                            let div_favorite = $("<div></div>").attr({
                                id: "favorite_container",
                            });
                            div_profile_skin.append(div_friend);
                            div_profile_skin.append(div_profile);
                            div_profile_skin.append(div_favorite);
                            $("#root").append(div_profile_skin);

                            //set personal token for more purposes
                            personal_token = profile_data["email"] ?
                                profile_data["email"] :
                                "";
                            // display available features of user
                            let profile_title = $("<div></div>").attr({
                                id: "atop_profile",
                            });
                            let profile_title_content = $("<p></p>");
                            profile_title_content.html("USER DATA");
                            profile_title.append(profile_title_content);

                            for (k of Object.keys(profile_data)) {
                                // 這2個keys暫時不處理；放到其他按鈕來處理
                                if (k === "friends") {
                                    continue;
                                } else if (k === "favorite") {
                                    continue;
                                }

                                let profile_box = $("<div></div>").attr({
                                    class: "profile_div_box",
                                });
                                let profile_box_title = $("<div></div>").attr({
                                    id: `profile_div_title_${k}`,
                                });
                                let profile_box_content = $("<div></div>").attr({
                                    id: `profile_div_content_${k}`,
                                });
                                let profile_key = $("<p></p>").attr({
                                    id: `profile_p_${k}`,
                                    class: "profile_filling",
                                });
                                let profile_value = $("<p></p>").attr({
                                    class: "profile_filling",
                                });
                                profile_key.html(`${k}`.toUpperCase());
                                profile_value.html(`${profile_data[k]}`);
                                profile_box_title.append(profile_key);
                                profile_box_content.append(profile_value);
                                profile_box.append(profile_box_title);
                                profile_box.append(profile_box_content);
                                div_profile.append(profile_box);
                            }
                            div_friend.append(
                                $("<button id='show_friend'>FRIEND LIST</button>")
                            );
                            div_favorite.append(
                                $("<button id='show_favorite'>POCKET LIST</button>")
                            );
                            // get friend and favorite here
                            // UPDATE: friend done;
                            // should have token here
                            let email;
                            try {
                                email = personal_token.replace(".", "%2E");
                            } catch (err) {
                                console.log("error occurred when urlencoding email:", err);
                                return;
                            }

                            // get friend list here
                            axios
                                .get(`${MAIN_HOST}/friends?email=${email}`, {
                                    headers: {
                                        "Access-Control-Allow-Origin": "*",
                                        "Content-Type": "application/json",
                                        Authorization: `Bearer ${token}`,
                                    },
                                })
                                .then((response) => {
                                    try {
                                        const data = response.data;
                                        console.log("response data: ", data);
                                        const friend_box = $("<div></div>").attr({
                                            class: "friend_box",
                                        });
                                        $("friend_container").append("<br>");
                                        $("#friend_container").append(friend_box);

                                        for (d of data) {
                                            const friend_case = $("<div></div>").attr({
                                                class: "friend_case",
                                            });

                                            const fid = d._id ? d._id : -1;
                                            //console.log("_id", fid);
                                            //console.log("typeof _id", typeof fid);
                                            friends_set.add(fid);

                                            const name = d.name ? d.name : "ANONYMOUS_USER";
                                            const name_box = $("<div></div>");
                                            const friend_left_hemi = $(
                                                "<div class='friend_left_hemi'></div>"
                                            );
                                            const default_avatar = $(
                                                `<img src="${profile_img_default_base64}">`
                                            );
                                            friend_left_hemi.append(default_avatar);
                                            const friend_right_hemi = $(
                                                "<div class='friend_right_hemi'></div>"
                                            );
                                            const name_h = $("<h4></h4>").text(`${name}`);
                                            name_box.append(name_h);
                                            friend_case.append(friend_left_hemi);
                                            friend_case.append(friend_right_hemi);
                                            //friend_left_hemi.append();

                                            const date = d.date ? d.date : Date.now();
                                            const manipulate_box = $(
                                                "<div id='manipulate_box'></div>"
                                            );
                                            // const date_p = $("<p></p>").text(`Joined on: ${date}`);
                                            // manipulate_box.append(date_p);
                                            const visit_friend_btn = $(
                                                "<button>  VISIT  </button>"
                                            ).attr({
                                                class: "btn-primary_light btn_medium",
                                            });
                                            const rm_suggest_btn = $(
                                                "<button>  REMOVE  </button>"
                                            ).attr({
                                                class: "btn-primary_light btn_medium",
                                            });
                                            friend_right_hemi.append(name_box);
                                            friend_right_hemi.append(manipulate_box);
                                            manipulate_box.append(visit_friend_btn);
                                            manipulate_box.append(rm_suggest_btn);
                                            friend_box.append(friend_case);
                                        }
                                        $(".friend_box").hide();
                                    } catch (err) {
                                        console.log("err in expanding friend data: ", err);
                                    }
                                })
                                .catch((err) => {
                                    console.log("err:", err);
                                });

                            // get favorite list here
                            axios
                                .get(`${MAIN_HOST}/favorite?email=${email}`, {
                                    headers: {
                                        "Access-Control-Allow-Origin": "*",
                                        "Content-Type": "application/json",
                                        Authorization: `Bearer ${token}`,
                                    },
                                })
                                .then((response) => {
                                    console.log("response:", response);
                                    try {
                                        const data = response.data.favorite;
                                        console.log("response data: ", data);
                                        const favorite = $("<div></div>").attr({
                                            class: "favorite_box",
                                        });
                                        $("#favorite_container").append(favorite);

                                        for (d of data) {
                                            const item = d.data;

                                            const name = item.rname ? item.rname : "ANONYMOUS_UNIT";
                                            const rid = item.rid ? item.rid : -1;
                                            favorite_set.add(rid);
                                            console.log("get favorite list: ", favorite);
                                            const favorite_case = $("<div></div>").attr({
                                                class: "favorite_case",
                                            });
                                            favorite.append(favorite_case);
                                            const name_box = $("<div></div>");
                                            const name_p = $("<p></p>").text(`name:${name}`);
                                            name_box.append(name_p);
                                            favorite_case.append(name_box);
                                        }
                                        $(".favorite_box").hide();
                                    } catch (err) {
                                        console.log("err in expanding friend data: ", err);
                                    }
                                    // display favorite restaurants
                                })
                                .catch((err) => {
                                    // display error
                                    console.log("error in get favorite: ", err);
                                });
                            // display features not available yet:

                            // first remove those we already have on browser
                            let residual_feature = new Set(user_features);
                            // 舊的做法：當前資料有的欄位就不顯示在input讓人修改
                            // 顯然不合理
                            // for (i of Object.keys(profile_data)) {
                            //     residual_feature.delete(i);
                            // }
                            // email目前不能修改

                            // for (i of Object.keys(profile_data)) {
                            //     residual_feature.delete(i);
                            // }
                            // email目前不能修改
                            residual_feature.delete("email");

                            let extra_profile = $("<div></div>").attr({
                                id: `extra_profile`,
                            });
                            div_profile.append(extra_profile);
                            let form = $("<form></form>").attr({
                                method: "post",
                                action: "javascript:console.log('oh~oh~oh');",
                            });
                            extra_profile.append(form);
                            //
                            for (i of residual_feature) {
                                let label = $("<label></label>").attr({
                                    for: `${i}`,
                                });
                                label.html(`${i}:`);
                                let input = $("<input></input>").attr({
                                    name: `${i}`,
                                    type: "text",
                                    class: "update_feature",
                                    value: `${profile_data[i] ? profile_data[i] : ""}`,
                                    //id: `update_feature_${i}`,
                                });
                                form.append(label);
                                form.append(input);
                                form.append("<br />");
                            }
                            let update_profile_btn = $(
                                "<button id='update_profile'>更新資料</button>"
                            );
                            form.append(update_profile_btn);

                            let update_body = {};
                            // QQQ.成功更新資料之後應該要刷新頁面
                            // when pressing 更新資料
                            $(document).on("click", "#update_profile", () => {
                                console.log("very cool");
                                $("input.update_feature").each(function(index, element) {
                                    // console.log(Object.keys(element));
                                    // console.log(typeof element.name);
                                    update_body[`${element.name}`] = `${element.value}`;
                                    // console.log("element:");
                                    //
                                    // this is not gonna work:
                                    // console.log(`${element.attr("name")}`);
                                });
                                // console.log("update_body: ", JSON.stringify(update_body));
                                const token = localStorage.getItem("jwt");
                                axios
                                    .post(`${MAIN_HOST}/profile`, update_body, {
                                        headers: {
                                            "Access-Control-Allow-Origin": "*",
                                            "Content-Type": "application/json",
                                            Authorization: `Bearer ${token}`,
                                        },
                                    })
                                    .then((response) => {
                                        alert("資料修改成功");
                                    })
                                    .catch((err) => {
                                        alert("更改資料失敗");
                                    });
                            });
                            //update_profile_btn prevent default
                            //post data to server
                            // if failed: do something
                            //if successful: rerender page
                            $("#return_result").remove();
                            console.log("res skin len:");
                            if ($("#restaurant_skin").length === 0) {} else {
                                const return_result = $("<div>Return To Search</div>").attr({
                                    id: "return_result",
                                    class: "nav-item nav-link",
                                });
                                $("#hide_search").after(return_result);
                            }
                        }
                        // verify successful
                    )
                    .catch((err) => {
                        // verify failed
                    });
            }
        });

        // 美食同好 按鈕
        //口袋名單 按鈕
        // QQQ. toggle: 顯示/隱藏
        let friend_toggle = 0;
        $(document).on("click", "#show_friend", () => {
            if (friend_toggle === 0) {
                $(".friend_box").show();
                friend_toggle = 1;
            } else {
                $(".friend_box").hide();
                friend_toggle = 0;
            }
        });
        let favorite_toggle = 0;
        $(document).on("click", "#show_favorite", () => {
            if (favorite_toggle === 0) {
                $(".favorite_box").show();
                favorite_toggle = 1;
            } else {
                $(".favorite_box").hide();
                favorite_toggle = 0;
            }

            // const token = localStorage.getItem("jwt");
            // if (!token) {
            //     $("#div_signout").hide();
            //     $("#div_profile").hide();
            // } else {
            //     let email;
            //     try {
            //         email = personal_token.replace(".", "%2E");
            //     } catch (err) {
            //         console.log("error occurred when urlencoding email:", err);
            //         return;
            //     }
            //     axios
            //         .get(`${MAIN_HOST}/favorite?email=${email}`, {
            //             headers: {
            //                 "Access-Control-Allow-Origin": "*",
            //                 "Content-Type": "application/json",
            //                 Authorization: `Bearer ${token}`,
            //             },
            //         })
            //         .then((response) => {
            //             console.log("response:", response);
            //             try {
            //                 const data = response.data.favorite;
            //                 console.log("response data: ", data);
            //                 for (d of data) {
            //                     const item = d.data;
            //                     const favorite = $("<div></div>").attr({
            //                         class: "favorite_box",
            //                     });
            //                     $("#favorite_container").append(favorite);
            //                     const name = item.rname ? item.rname : "ANONYMOUS_UNIT";
            //                     const name_box = $("<div></div>");
            //                     const name_p = $("<p></p>").text(`name:${name}`);
            //                     name_box.append(name_p);
            //                     favorite.append(name_box);
            //                 }
            //             } catch (err) {
            //                 console.log("err in expanding friend data: ", err);
            //             }
            //             // display favorite restaurants
            //         })
            //         .catch((err) => {
            //             // display error
            //             console.log("error in get favorite: ", err);
            //         });
            // }
        });

        // 細節頁的收藏按鈕
        $(document).on("click", "#add_favorite", (event) => {
            const token = localStorage.getItem("jwt");
            if (!token) {
                // QQQ.這個地方可能需要一起把 #signin / #signup 加回去(不只這邊)
                // R: 已經加了，之後再確認別的地方
                alert("You are not signed in. Please sign in first.");
                $("#div_signout").hide();
                $("#div_profile").hide();
                $("#show_signin").show();
                $("#show_signup").show();
            } else {
                const target = $(event.currentTarget);
                const rid = target.parent().siblings("#rid").text();
                let rname = target
                    .parent()
                    .siblings("#detail_name")
                    .children()
                    .text();
                rname = rname.replace("名稱：", "");
                const restaurant_obj = {
                    rid,
                    rname,
                };
                console.log("current rid: ", rid);
                console.log("current rname: ", rname.replace("名稱：", ""));

                let is_favorite = favorite_set.has(rid);
                if (1) {
                    axios
                        .post(
                            `${MAIN_HOST}/favorite`, {
                                personal_token,
                                restaurant_obj,
                                action: is_favorite ? 0 : 1, //0: remove; 1: add
                            }, {
                                headers: {
                                    "Access-Control-Allow-Origin": "*",
                                    "Content-Type": "application/json",
                                    Authorization: `Bearer ${token}`,
                                },
                            }
                        )
                        .then((response) => {
                            const data = response.data;
                            //log state
                            console.log("is_favorite: ", is_favorite);
                            if (is_favorite) {
                                // 移除高光
                                favorite_set.delete(rid);
                                $("#add_favorite").removeClass("favorite_store_t");
                                $("#add_favorite").addClass("favorite_store_f");
                                $("#add_favorite").text("Add To Pocket List");
                            } else {
                                //顯示高光
                                favorite_set.add(rid);
                                $("#add_favorite").removeClass("favorite_store_f");
                                $("#add_favorite").addClass("favorite_store_t");
                                $("#add_favorite").text("Remove From Pocket List");
                            }

                            // console.log(
                            //     "add favorite successful response:",
                            //     JSON.stringify(response)
                            // );
                        })
                        .catch((err) => {
                            // log error
                            console.log(
                                "add favorite Unsuccessful response:",
                                JSON.stringify(err)
                            );
                        });
                }
            }
        });

        // 結果頁的收藏按鈕
        // QQQ. 按下收藏要檢查登入狀態，如果沒有登入，要提示先登入
        $(document).on("click", ".favorite_ff", (event) => {
            const token = localStorage.getItem("jwt");
            if (!token) {
                // QQQ.這個地方可能需要一起把 #signin / #signup 加回去(不只這邊)
                // R: 已經加了，之後再確認別的地方
                alert("You are not signed in. Please sign in first.");
                $("#div_signout").hide();
                $("#div_profile").hide();
                $("#show_signin").show();
                $("#show_signup").show();
            } else {
                const target = $(event.currentTarget);
                // console.log("target: ", target);
                // console.log("event.target", event.target);
                console.log("target:", target);
                console.log("target.parent:", target.parent());
                console.log("target.parent.siblings:", target.parent().siblings());
                const rid = target.children("p").text();
                const rname = target.parent().siblings(".item_real_name").text();
                const restaurant_obj = {
                    rid,
                    rname,
                };
                console.log("current rid: ", rid);
                console.log("current rname: ", rname.replace("名稱：", ""));

                let is_favorite = favorite_set.has(rid);
                //console.log("is_favorite:", is_favorite);
                if (1) {
                    axios
                        .post(
                            `${MAIN_HOST}/favorite`, {
                                personal_token,
                                restaurant_obj,
                                action: is_favorite ? 0 : 1, //0: remove; 1: add
                            }, {
                                headers: {
                                    "Access-Control-Allow-Origin": "*",
                                    "Content-Type": "application/json",
                                    Authorization: `Bearer ${token}`,
                                },
                            }
                        )
                        .then((response) => {
                            const data = response.data;
                            //log state
                            //console.log("is_favorite: ", is_favorite);
                            if (is_favorite) {
                                // 移除高光
                                favorite_set.delete(rid);
                                target.removeClass("favorite_store_t");
                                target.addClass("favorite_store_f");
                            } else {
                                //顯示高光
                                favorite_set.add(rid);
                                target.removeClass("favorite_store_f");
                                target.addClass("favorite_store_t");
                            }

                            // console.log(
                            //     "add favorite successful response:",
                            //     JSON.stringify(response)
                            // );
                        })
                        .catch((err) => {
                            // log error
                            console.log(
                                "add favorite Unsuccessful response:",
                                JSON.stringify(err)
                            );
                        });
                }
            }
        });

        $(document).on("click", "#return_result", (event) => {
            // $("#restaurant_container").show();
            // $("#pagination").show();
            $("#restaurant_skin").show();
            $("#detail_container").remove();
            // $("#profile_container").hide();
            // $("#friend_container").hide();
            // $("#favorite_container").hide();
            $("#profile_skin").hide();
        });

        $(document).on("click", "#google_review_div_toggle_div", (event) => {
            if (!display_google_reviews) {
                $("#google_reviews_container").show();
                display_google_reviews = true;
            } else {
                $("#google_reviews_container").hide();
                display_google_reviews = false;
            }
        });

        let place = $("#id_label_1"),
            exotic = $("#id_label_2"),
            estab = $("#id_label_3"),
            menu = $("#id_label_4"),
            pricelv = $("#id_label_5"),
            rating = $("#id_label_6"),
            ophour = $("#id_label_7"),
            amenit = $("#id_label_8"),
            opennow = $("#id_label_9");

        // QQQ. 按照現在的邏輯，按下搜尋時要把profile(div_profile) 藏起來
        $("#selected_fire").click((event) => {
            $(".pagination").remove();
            let place_arr = [];
            let selected_place = place.find(":selected");
            for (i of selected_place) {
                place_arr.push(i.innerHTML);
                //console.log("i.innerHTML: ", i.innerHTML);
            }

            let exotic_arr = [];
            let selected_exotic = exotic.find(":selected");
            for (i of selected_exotic) {
                exotic_arr.push(i.innerHTML);
                //console.log("i.innerHTML: ", i.innerHTML);
            }

            let estab_arr = [];
            let selected_estab = estab.find(":selected");
            for (i of selected_estab) {
                estab_arr.push(i.innerHTML);
                //console.log("i.innerHTML: ", i.innerHTML);
            }

            let menu_arr = [];
            let selected_menu = menu.find(":selected");
            for (i of selected_menu) {
                menu_arr.push(i.innerHTML);
                //console.log("i.innerHTML: ", i.innerHTML);
            }

            let pricelv_arr = [];
            let selected_pricelv = pricelv.find(":selected");
            for (i of selected_pricelv) {
                pricelv_arr.push(i.innerHTML);
                //console.log("i.innerHTML: ", i.innerHTML);
            }

            let rating_arr = [];
            let selected_rating = rating.find(":selected");
            for (i of selected_rating) {
                rating_arr.push(i.innerHTML);
                //console.log("i.innerHTML: ", i.innerHTML);
            }

            let ophour_arr = [];
            let selected_ophour = ophour.find(":selected");
            for (i of selected_ophour) {
                ophour_arr.push(i.innerHTML);
                //console.log("i.innerHTML: ", i.innerHTML);
            }

            let amenit_arr = [];
            let selected_amenit = amenit.find(":selected");
            for (i of selected_amenit) {
                amenit_arr.push(i.innerHTML);
                //console.log("i.innerHTML: ", i.innerHTML);
            }

            let opennow_arr = [];
            let selected_opennow = opennow.find(":selected");
            for (i of selected_opennow) {
                opennow_arr.push(i.innerHTML);
                //console.log("i.innerHTML: ", i.innerHTML);
            }

            // console.log("sel_place: ", sel_place);
            // $("#root").append(`<p>${sel_place}</p>`);

            axios
                .post(
                    `${MAIN_HOST}/search_experiment`, {
                        place: place_arr, //formatted_address
                        exotic: exotic_arr, //reviews.text
                        estab: estab_arr, //reviews.text
                        menu: menu_arr, //reviews.text
                        pricelv: pricelv_arr,
                        rating: rating_arr,
                        ophour: ophour_arr, ////reviews.text e.g.早餐，午餐，晚餐
                        amenit: amenit_arr, //reviews.text
                        opennow: opennow_arr, //
                    }, {
                        headers: {
                            "Access-Control-Allow-Origin": "*",
                            "Content-Type": "application/json",
                        },
                    }
                )
                .then((response) => {
                    const data = response.data;
                    //$("#root").append(`<p>${JSON.stringify(data.hits)}</p>`);
                    console.log(data);
                    $("#restaurant_skin").remove();
                    $("#detail_box").remove();

                    // QQQ.我覺得這要再考慮一下。可能設個計時器，超過時間才remove，不然hide就好。
                    // $("#profile_container").remove();
                    // $("#friend_container").remove();
                    // $("#favorite_container").remove();
                    $("#profile_skin").remove();

                    hits_arr = [];
                    page_len = data.hits.hits.length;
                    data.hits.hits.forEach((element, index) => {
                        // if (index !== 0) {
                        //     return;
                        // }
                        hits_arr.push({
                            data: element._source,
                            id: element._id,
                        });
                    });
                    console.log("length of hits_arr: ", hits_arr.length);
                    cnt = 0;
                    let div_restaurant_skin = $("<div></div>").attr({
                        id: "restaurant_skin",
                    });
                    let div_container = $("<div></div>").attr({
                        id: "restaurant_container",
                    });

                    div_restaurant_skin.append(div_container);

                    let div_membrane = $("<div></div>").attr({
                        id: "restaurant_membrane",
                    });
                    $("#root").append(div_restaurant_skin);
                    $("#restaurant_container").append(div_membrane);

                    let is_favorite = 0;
                    for (ho of hits_arr) {
                        const h = ho.data;
                        //console.log(ho.id);
                        let div_box = $("<div></div>").attr({
                            id: `h${cnt}`,
                            class: "restaurant_box",
                        });
                        const restaurant_box_left_hemi = $("<div></div>").attr({
                            class: "restaurant_box_left_hemi",
                        });
                        const restaurant_box_right_hemi = $("<div></div>").attr({
                            class: "restaurant_box_right_hemi",
                        });
                        const restaurant_box_dura = $("<div></div>").attr({
                            class: "restaurant_box_dura",
                        });

                        const restaurant_box_neck = $("<div></div>").attr({
                            class: "restaurant_box_neck",
                        });
                        restaurant_box_dura.append(restaurant_box_right_hemi);
                        restaurant_box_dura.append(restaurant_box_neck);
                        div_box.append(restaurant_box_left_hemi);
                        div_box.append(restaurant_box_dura);
                        div_membrane.append(div_box);
                        const r_img = $("<img>").attr({
                            src: `${default_restaurant_list_img_path}${Date.now() % 5}.jpg`,
                            alt: "restaurant_list_pic",
                            width: "360px",
                        });
                        restaurant_box_left_hemi.append(r_img);

                        is_favorite = favorite_set.has(ho.id);
                        //"<div><img src='./hoshizora.svg' alt='Hoshi'></div>"
                        const starred_cointainer = $("<div>").attr({
                            class: "starred_container",
                        });
                        const starred = $("<div>").attr({
                            class: is_favorite ? "favorite_store_t" : "favorite_store_f",
                        });
                        starred.addClass("favorite_ff");
                        starred_cointainer.append(starred);
                        const id_content = $(`<p>${ho.id}</p>`).css("display", "none");
                        starred.append(id_content);
                        restaurant_box_right_hemi.append(starred_cointainer);
                        //
                        const r_name = $("<div>").attr({
                            class: "item_name_div",
                        });
                        //use ${cnt + 1}. to debug
                        const r_name_p = $(`<p>${h.name}</p>`).attr({
                            id: `item_title_${cnt}`,
                            class: "item_name_p",
                        });
                        r_name.append(r_name_p);
                        restaurant_box_right_hemi.append(r_name);
                        //
                        restaurant_box_right_hemi.append(
                            `<p class="item_real_name" style="display:none">${h.name}</p>`
                        );

                        //
                        let plv = h.price_level;
                        if (!plv) {
                            plv = "🤔";
                        } else {
                            const plv_cnt = plv;
                            plv = "";
                            for (plv_i = 0; plv_i < plv_cnt; plv_i++) {
                                plv += "$";
                            }
                        }

                        const r_rating_plv = $("<div>").attr({
                            class: "item_rating_plv_div",
                        });
                        const r_rating_pricelv_p = $(
                            `<p>Rating: ${h.rating} (100+) · ${plv}</p>`
                        ).attr({
                            class: "item_rating_plv_p",
                        });
                        r_rating_plv.append(r_rating_pricelv_p);
                        restaurant_box_right_hemi.append(r_rating_plv);

                        //
                        const r_address = $("<div>").attr({
                            class: "item_address_div",
                        });
                        const r_address_p = $(`<p>${h.formatted_address}</p>`).attr({
                            class: "item_address_p",
                        });
                        r_address.append(r_address_p);
                        restaurant_box_right_hemi.append(r_address);

                        //
                        let opening_hours;
                        try {
                            //weekday_text is an array
                            opening_hours = Array.from(h.opening_hours.weekday_text);
                            // console.log(
                            //     "initial opening_hours: ",
                            //     opening_hours[0].toString()
                            // );
                        } catch (err) {
                            console.log(
                                "An error occurred, might haven't caught data weekday_text correctly:",
                                err
                            );
                            opening_hours = "無資料";
                        }
                        // /*
                        // opening_hours is like:
                        //     星期一: 11:30 – 14:30, 17:30 – 23:30,
                        //     星期二: 11:30 – 14:30, 17:30 – 23:30,
                        //     星期三: 11:30 – 14:30, 17:30 – 23:30,
                        //     星期四: 11:30 – 14:30, 17:30 – 23:30,
                        //     星期五: 11:30 – 14:30, 17:30 – 23:30,
                        //     星期六: 11:30 – 14:30, 17:30 – 23:30,
                        //     星期日: 休息
                        // */
                        //console.log("opening_hours::", opening_hours);
                        let full_opening_hours_text =
                            opening_hours === "無資料" ? [] : Array.from(opening_hours);

                        //console.log("opening_hours::", opening_hours);
                        //console.log("full_opening_hours_text::", full_opening_hours_text);

                        if (opening_hours === "無資料") {
                            //no data
                            opening_hours = [];
                        } else {
                            // opening_hours = opening_hours.replace("星期", "BRK星期");
                            // opening_hours = opening_hours.split("BRK");
                            // /* opening_hours is like:
                            // [
                            //     "",
                            //     "星期一: 11:30 – 14:30, 17:30 – 23:30,"
                            //     "星期二: 11:30 – 14:30, 17:30 – 23:30,"
                            //     "星期三: 11:30 – 14:30, 17:30 – 23:30,"
                            //     "星期四: 11:30 – 14:30, 17:30 – 23:30,"
                            //     "星期五: 11:30 – 14:30, 17:30 – 23:30,"
                            //     "星期六: 11:30 – 14:30, 17:30 – 23:30,"
                            //     "星期日: 休息"
                            // ]
                            // */
                            // opening_hours = opening_hours.slice(1);

                            opening_hours.forEach((v, i, opening_hours) => {
                                opening_hours[i] = [
                                    opening_dict[`${opening_hours[i].split(":")[0]}`],
                                    opening_hours[i].includes("休息") ?
                                    [] :
                                    opening_hours[i].slice(5).split(","),
                                ];
                            });
                            // /* opening_hours is like:
                            // [
                            // [1, ["11:30 – 14:30", "17:30 – 23:30"]
                            // [2, ["11:30 – 14:30", "17:30 – 23:30"]
                            // [3, ["11:30 – 14:30", "17:30 – 23:30"]
                            // [4, ["11:30 – 14:30", "17:30 – 23:30"]
                            // [5, ["11:30 – 14:30", "17:30 – 23:30"]
                            // [6, ["11:30 – 14:30", "17:30 – 23:30"]
                            // [0, []]
                            // ]
                            // */
                            // or [] if there is no data
                        }
                        let cur_opening = -1; // default value meaning no data

                        const cur_time = new Date(Date.now());
                        const cur_week_day = cur_time.getDay(),
                            cur_hour = cur_time.getHours(), //24H
                            cur_minute = cur_time.getMinutes();
                        //cur_week_day = 0~6  = Sun ~ Sat

                        for (arr of opening_hours) {
                            if (arr[0] === cur_week_day) {
                                // console.log("cur_week_day:", cur_week_day);

                                // arr[1] = [] when:
                                // opening_hours[i].includes("休息") ?
                                // [] :
                                // opening_hours[i].slice(5).split(","),
                                if (arr[1].length === 0) {
                                    cur_opening = 0;
                                    break;
                                }
                                for (let data_index of arr[1]) {
                                    // data is like:
                                    // "11:30 – 14:30"
                                    let parsed_data = data_index;
                                    // console.log("arr[1]: ", arr[1].toString());
                                    // console.log("arr[1] length: ", arr[1].length);
                                    // console.log("parsed_data length", parsed_data.length);
                                    // console.log("parsed_data: ", parsed_data.toString());

                                    parsed_data = parsed_data.replace(" ", "").replace(" ", "");
                                    parsed_data = parsed_data.split("–");
                                    // parsed_data is like:
                                    // ["11:30","14:30"]
                                    // console.log("parsed_data length", parsed_data.length);
                                    // console.log("parsed_data: ", parsed_data.toString());
                                    if (parsed_data.toString() === "24小時營業") {
                                        cur_opening = 1;
                                        break;
                                    }
                                    let open_hr, open_minute, close_minute, close_hr;
                                    try {
                                        open_hr = Number(parsed_data[0].split(":")[0]);
                                        open_minute = Number(parsed_data[0].split(":")[1]);

                                        close_hr = Number(parsed_data[1].split(":")[0]);
                                        close_minute = Number(parsed_data[1].split(":")[1]);
                                    } catch (err) {
                                        console.log("err in open hours: ", err);
                                        console.log(
                                            "OPED: ",
                                            parsed_data.toString(),
                                            open_hr,
                                            open_minute,
                                            close_minute,
                                            close_hr
                                        );
                                    }

                                    //console.log("cnt: ", cnt);
                                    // if (cnt === 4)
                                    //     console.log("CUR TIME: ", cur_hour, cur_minute);
                                    // if (cnt === 4) console.log("cur_opening: ", cur_opening);
                                    if (cur_hour < open_hr) {
                                        cur_opening = cur_opening === 1 ? 1 : 0;
                                        // if (cnt === 4) console.log("cur_opening1: ", cur_opening);

                                        continue;
                                    } else if (cur_hour === open_hr) {
                                        if (cur_minute < open_minute) {
                                            cur_opening = cur_opening === 1 ? 1 : 0;
                                            // if (cnt === 4)
                                            //     console.log("cur_opening2: ", cur_opening);
                                            continue;
                                        }
                                    }
                                    if (cur_hour > close_hr) {
                                        cur_opening = cur_opening === 1 ? 1 : 0;
                                        // if (cnt === 4) console.log("cur_opening3: ", cur_opening);
                                        continue;
                                    } else if (cur_hour === close_hr) {
                                        if (cur_minute > close_minute) {
                                            cur_opening = cur_opening === 1 ? 1 : 0;
                                            // if (cnt === 4)
                                            //     console.log("cur_opening4: ", cur_opening);
                                            continue;
                                        }
                                    }
                                    cur_opening = 1;
                                }
                            }
                        }
                        //cur_opening = -1 0 1 : no data / closed / opening
                        if (cnt === 4) console.log("cur_opening: ", cur_opening);
                        const r_ophours = $("<div>").attr({
                            class: "item_ophours_div",
                        });

                        const op_cond = $("<div>").attr({
                            class: "op_cond",
                        });
                        const op_sig = $("<div>").attr({
                            class: `status_${cur_opening + 2}`,
                        });
                        const op_text =
                            cur_opening === -1 ?
                            "NO DATA" :
                            cur_opening === 0 ?
                            "CLOSED" :
                            "OPENING";
                        const op_text_div = $("<div>").attr({
                            class: "op_text_div",
                        });
                        const op_text_p = $("<p>").attr({
                            class: "op_text_p",
                            id: `op_text_p_${cnt}`,
                        });

                        op_text_p.text(op_text);

                        op_cond.append(op_sig);
                        op_cond.append(op_text_div);
                        op_text_div.append(op_text_p);

                        r_ophours.append(op_cond);
                        const empty_div = $("<div>").attr({
                            class: "full_op_box",
                            id: `op_box_${cnt}`,
                        });
                        empty_div.hide();
                        op_text_p.click((event) => {
                            empty_div.toggle();
                        });
                        const div_in_empty_div = $("<div>").attr({
                            class: "div_in_empty_div",
                        });
                        let ophours_piece_div, ophours_piece_p;
                        if (full_opening_hours_text.length === 0) {
                            ophours_piece_div = $("<div>");
                            ophours_piece_p = $("<p>");
                            ophours_piece_p.text("無營業時間資料");
                            div_in_empty_div.append(ophours_piece_div);
                            ophours_piece_div.append(ophours_piece_p);
                        } else {
                            for (piece of full_opening_hours_text) {
                                ophours_piece_div = $("<div>");
                                ophours_piece_p = $("<p>");
                                ophours_piece_p.text(piece);
                                div_in_empty_div.append(ophours_piece_div);
                                ophours_piece_div.append(ophours_piece_p);
                            }
                        }
                        empty_div.append(div_in_empty_div);
                        r_ophours.append(empty_div);
                        restaurant_box_right_hemi.append(r_ophours);
                        //
                        const social_info = $("<div>").attr({
                            class: "social_info_div",
                        });
                        const social_info_text = "Some friends also like this restaurant";
                        const social_info_p = $(`<p>${social_info_text}</p>`).attr({
                            class: "item_social_info_p",
                        });
                        social_info.append(social_info_p);
                        restaurant_box_neck.append(social_info);
                        //
                        cnt++;
                    }
                    (function($) {
                        let pagify = {
                            items: {},
                            container: null,
                            totalPages: 1,
                            perPage: 3,
                            currentPage: 0,
                            createNavigation: function() {
                                this.totalPages = Math.ceil(this.items.length / this.perPage);
                                console.log("total pages: ", this.totalPages);

                                $(".pagination", this.container.parent()).remove();
                                let pagination = $(
                                    '<div class="pagination" id="pagination"></div>'
                                ).append(
                                    '<a class="nav prev disabled" data-next="false"><</a>'
                                );

                                for (let i = 0; i < this.totalPages; i++) {
                                    let pageElClass = "page";
                                    if (!i) pageElClass = "page current";
                                    let pageEl =
                                        '<a class="' +
                                        pageElClass +
                                        '" data-page="' +
                                        (i + 1) +
                                        '">' +
                                        (i + 1) +
                                        "</a>";
                                    pagination.append(pageEl);
                                }
                                pagination.append(
                                    '<a class="nav next" data-next="true">></a>'
                                );

                                this.container.after(pagination);

                                let that = this;
                                $("body").off("click", ".nav");
                                this.navigator = $("body").on("click", ".nav", function() {
                                    let el = $(this);
                                    that.navigate(el.data("next"));
                                });

                                $("body").off("click", ".page");
                                this.pageNavigator = $("body").on(
                                    "click",
                                    ".page",
                                    function() {
                                        let el = $(this);
                                        that.goToPage(el.data("page"));
                                    }
                                );
                            },
                            navigate: function(next) {
                                // default perPage to 5
                                if (isNaN(next) || next === undefined) {
                                    next = true;
                                }
                                $(".pagination .nav").removeClass("disabled");
                                if (next) {
                                    this.currentPage++;
                                    if (this.currentPage > this.totalPages - 1)
                                        this.currentPage = this.totalPages - 1;
                                    if (this.currentPage == this.totalPages - 1)
                                        $(".pagination .nav.next").addClass("disabled");
                                } else {
                                    this.currentPage--;
                                    if (this.currentPage < 0) this.currentPage = 0;
                                    if (this.currentPage == 0)
                                        $(".pagination .nav.prev").addClass("disabled");
                                }

                                this.showItems();
                            },
                            updateNavigation: function() {
                                let pages = $(".pagination .page");
                                pages.removeClass("current");
                                $(
                                    '.pagination .page[data-page="' +
                                    (this.currentPage + 1) +
                                    '"]'
                                ).addClass("current");
                            },
                            goToPage: function(page) {
                                this.currentPage = page - 1;

                                $(".pagination .nav").removeClass("disabled");
                                if (this.currentPage == this.totalPages - 1)
                                    $(".pagination .nav.next").addClass("disabled");

                                if (this.currentPage == 0)
                                    $(".pagination .nav.prev").addClass("disabled");
                                this.showItems();
                            },
                            showItems: function() {
                                this.items.hide();
                                let base = this.perPage * this.currentPage;
                                this.items.slice(base, base + this.perPage).show();

                                this.updateNavigation();
                            },
                            init: function(container, items, perPage) {
                                this.container = container;
                                this.currentPage = 0;
                                this.totalPages = 1;
                                this.perPage = perPage;
                                this.items = items;
                                this.createNavigation();
                                this.showItems();
                            },
                        };

                        // stuff it all into a jQuery method!
                        $.fn.pagify = function(perPage, itemSelector) {
                            let el = $(this);
                            let items = $(itemSelector, el);

                            // default perPage to 5
                            if (isNaN(perPage) || perPage === undefined) {
                                perPage = 3;
                            }

                            // don't fire if fewer items than perPage
                            if (items.length <= perPage) {
                                return true;
                            }

                            pagify.init(el, items, perPage);
                        };
                    })(jQuery);

                    if (hits_arr.length === 0) {
                        let empty_reminder_box = $("<div></div>");
                        let empty_reminder_p = $("<p>沒有你要找的餐廳</p>");
                        empty_reminder_box.append(empty_reminder_p);
                        div_membrane.append(empty_reminder_box);
                    }

                    $("#restaurant_container").pagify(10, ".restaurant_box");
                    $("#hide_search").show();
                    $("#modify_search").show();
                    $("#filters").hide();
                    console.log("success");
                })
                .catch((error) => {
                    console.log("An error occurred:", error);
                })
                .finally(() => {
                    console.log("finally");
                });
        });
        $("#modify_search").click((event) => {
            $("#filters").show();
            $("#hide_search").show();
        });
        $("#hide_search").click((event) => {
            $("#filters").hide();
        });
        let test_cnt = 0;
        // DDDCCC document ONs here:
        $(document).on("click", "#post_review_btn", (event) => {
            console.log("let user post a review:");
            const token = localStorage.getItem("jwt");
            if (!token) {
                // QQQ.這個地方可能需要一起把 #signin / #signup 加回去(不只這邊)
                // R: 已經加了，之後再確認別的地方
                alert("You are not signed in. Please sign in first.");
                $("#div_signout").hide();
                $("#div_profile").hide();
                $("#show_signin").show();
                $("#show_signup").show();
            } else {
                $("#new_comment_board").remove();
                let fresh_review_block = $("<div>").attr({
                    id: "new_comment_board",
                    class: "native_new_review_block",
                });
                // head
                let review_head = $("<div>").attr({
                    class: "native_new_review_head",
                });
                fresh_review_block.append(review_head);

                // title
                let review_title = $("<div>").attr({
                    class: "native_new_review_title",
                });
                let review_title_input = $("<input>").attr({
                    type: "text",
                    placeholder: "Title",
                });
                review_head.append(review_title);
                review_title.append(review_title_input);

                // rating
                let rating_form = $(`<form action="" id="rating_form">
              <input class="star star-5" id="star-5" type="radio" name="star"/>
              <label class="star star-5" for="star-5"></label>
              <input class="star star-4" id="star-4" type="radio" name="star"/>
              <label class="star star-4" for="star-4"></label>
              <input class="star star-3" id="star-3" type="radio" name="star"/>
              <label class="star star-3" for="star-3"></label>
              <input class="star star-2" id="star-2" type="radio" name="star"/>
              <label class="star star-2" for="star-2"></label>
              <input class="star star-1" id="star-1" type="radio" name="star"/>
              <label class="star star-1" for="star-1"></label>
            </form>`);
                review_head.append(rating_form);

                // head

                // content
                let review_content = $("<div>").attr({
                    class: "native_new_review_content",
                });
                let review_content_input = $("<textarea>").attr({
                    placeholder: "Content",
                    rows: "5",
                    cols: "54",
                });

                fresh_review_block.append(review_content);
                review_content.append(review_content_input);

                // buttom buttons
                let review_bottom = $("<div>").attr({
                    class: "native_review_bottom",
                });

                let submit_post_review_btn = $("<button>POST</button>").attr({
                    class: "btn btn-warning btn-sm btn-radius",
                });
                let cancel_post_review_btn = $("<button>CANCEL</button>").attr({
                    class: "btn btn-warning btn-sm btn-radius",
                });

                fresh_review_block.append(review_bottom);
                review_bottom.append(submit_post_review_btn);
                review_bottom.append(cancel_post_review_btn);

                submit_post_review_btn.click((event) => {
                    //alert("Yout post has been saved.");
                    // verify token
                    const title = review_title_input.val(),
                        content = review_content_input.val(),
                        restaurant_esid = $("#rid").text(),
                        restaurant_name = $("#detail_name").children().text();

                    console.log("title: ", title);
                    console.log("content: ", content);
                    console.log("restaurant_esid: ", restaurant_esid);
                    console.log("restaurant_name: ", restaurant_name);

                    let rating = 0;
                    for (let i = 0; i < 6; i++) {
                        if ($(`#star-${i}`).is(":checked")) {
                            rating = i;
                            break;
                        }
                    }
                    if (rating === 0) {
                        alert("Rating cannot be empty.");
                        return;
                    }

                    if (content === "") {
                        alert("Content cannot be empty.");
                        return;
                    }

                    axios
                        .post(
                            `${MAIN_HOST}/review`, {
                                restaurant_esid,
                                restaurant_name,
                                title,
                                content,
                                rating,
                            }, {
                                headers: {
                                    "Access-Control-Allow-Origin": "*",
                                    "Content-Type": "application/json",
                                    Authorization: `Bearer ${token}`,
                                },
                            }
                        )
                        .then((response) => {
                            $("#empty_review_block").remove();

                            //console.log("rating of review: ", rating);

                            // user_name, time會在通過後端驗證後返回
                            const res_user_name = response.data.name;
                            const res_title = response.data.title;
                            const res_content = response.data.content;
                            const res_time = response.data.time;
                            const res_rating = response.data.rating;

                            //$(".empty_review_div").parent().remove();
                            $("#new_comment_board").remove();
                            const post = attach_post_to_container(
                                "native_reviews_container",
                                res_user_name,
                                res_title,
                                res_content,
                                res_time,
                                res_rating
                            );
                            let review_legs_data = "Yang and Mai like this";
                            let review_legs = $("<div>").attr({
                                class: "fresh_review_legs",
                            });
                            let review_legs_detail_div = $("<div>").attr({
                                class: "review_legs_detail",
                            });
                            let review_legs_detail_p = $("<p>");
                            review_legs_detail_p.text(review_legs_data);
                            review_legs.append(review_legs_detail_div);
                            review_legs_detail_div.append(review_legs_detail_p);

                            post.append(review_legs);
                            fresh_review_block.remove();
                        })
                        .catch((err) => {
                            // other error
                            console.log("An error occurred in posting review: ", err);
                            alert(`An error occurred in posting review: ${err}`);
                        });
                    //
                });
                cancel_post_review_btn.click((event) => {
                    fresh_review_block.remove();
                });
                $("#native_reviews_container").append(fresh_review_block);

                // end of bottom buttons
            }
        });

        // for (let i_ = 0; i < page_len; i++) {
        for (let hits_i = 0; hits_i < 28; hits_i++) {
            //console.log("current hooked i: ", hits_i);
            $(document).on("click", `#item_title_${hits_i}`, () => {
                $("#detail_container").remove();
                //console.log("item is dnclicked:", hits_i);
                let detail_data = hits_arr[hits_i].data;
                const rid = hits_arr[hits_i].id;
                //console.log("rid: ", rid);
                //console.log("the data is: ", JSON.stringify(detail_data));
                let detail_container = $("<div></div>").attr({
                    id: "detail_container",
                });
                let detail_head = $("<div></div>").attr({
                    id: "detail_head",
                });
                let detail_meninges = $("<div>").attr({
                    id: "detail_meninges",
                });
                let detail_left_hemi = $("<div></div>").attr({
                    id: "detail_left_hemi",
                });
                let detail_right_hemi = $("<div></div>").attr({
                    id: "detail_right_hemi",
                });
                // body is for comments
                let detail_body = $("<div></div>").attr({
                    id: "detail_body",
                });
                let detail_box = $("<div></div>").attr({
                    id: "detail_box",
                });

                let detail_img = $("<img>").attr({
                    src: default_restaurant_detail_img_path,
                    alt: "restaurant_detail_pic",
                    width: "100%",
                });
                detail_head.append(detail_meninges);
                detail_meninges.append(detail_left_hemi);
                detail_meninges.append(detail_right_hemi);
                detail_right_hemi.append(detail_box);

                detail_container.append(detail_head);
                detail_container.append(detail_body);
                $("#root").append(detail_container);

                //
                detail_left_hemi.append(detail_img);
                // add to favorite
                const add_to_wish_div = $("<div></div>").attr({
                    id: "add_to_wish_div",
                });
                let add_to_wish_btn = $("<button>Add To Pocket List</button>").attr({
                    id: "add_favorite",
                    class: "btn_medium",
                });
                detail_box.append(add_to_wish_div);
                add_to_wish_div.append(add_to_wish_btn);

                let is_favorite = favorite_set.has(rid);
                console.log("is_favorite at detail page: ", is_favorite);
                if (is_favorite) {
                    //$("#add_favorite").addClass("favorite_store_t");
                    add_to_wish_btn.addClass("favorite_store_t");
                    add_to_wish_btn.text("Remove From Pocket List");
                    console.log("fst");
                } else {
                    //$("#add_favorite").addClass("favorite_store_f");
                    add_to_wish_btn.addClass("favorite_store_f");
                    add_to_wish_btn.text("Add To Pocket List");
                    console.log("fsf");
                }

                detail_box.append(`<div id="rid">${rid}</div>`);

                const name_div = $("<div></div>").attr({
                    id: "detail_name",
                });
                const address_div = $("<div></div>").attr({
                    id: "detail_address",
                });
                const rating_div = $("<div></div>").attr({
                    id: "detail_rating",
                });
                const pricelv_div = $("<div></div>").attr({
                    id: "detail_pricelv",
                });
                const ophours_div = $("<div></div>").attr({
                    id: "detail_ophours",
                });
                const phone_div = $("<div></div>").attr({
                    id: "detail_phone",
                });
                const website_div = $("<div></div>").attr({
                    id: "detail_website",
                });

                const name_p = $(`<p>${detail_data.name}</p>`);
                name_div.append(name_p);
                detail_box.append(name_div);

                const address_p = $(`<p>${detail_data.formatted_address}</p>`);
                address_div.append(address_p);
                detail_box.append(address_div);
                const rating_p = $(`<p>Rating：${detail_data.rating}</p>`);
                rating_div.append(rating_p);
                detail_box.append(rating_div);

                let plv = detail_data.price_level;
                if (!plv) {
                    plv = "🤔";
                } else {
                    const plv_cnt = plv;
                    plv = "";
                    for (_ = 0; _ < plv_cnt; _++) {
                        plv += "$";
                    }
                }
                const pricelv_p = $(`<p>Price Range：${plv}</p>`);
                pricelv_div.append(pricelv_p);
                detail_box.append(pricelv_div);

                let opening_hours;
                try {
                    //weekday_text is an array
                    opening_hours = detail_data.opening_hours.weekday_text;
                } catch (err) {
                    console.log(
                        "An error occurred, might haven't caught data weekday_text correctly:",
                        err
                    );
                    opening_hours = "無資料";
                }
                const ophours_title_div = $("<div>").attr({
                    id: "ophours_title_div",
                });
                const ophours_title_p = $("<p>Hours:</p>");
                ophours_title_div.append(ophours_title_p);

                const ophours_content_div = $("<div>").attr({
                    id: "ophours_content_div",
                });
                const ophours_content_p = $(`<p>${opening_hours}</p>`).attr({
                    id: "ophours_content_p",
                });

                let oph_cnt = 0;
                for (it of opening_hours) {
                    if (oph_cnt === 0) {
                        oph_cnt++;
                    } else {
                        const ophours_content_separator = $("<div>").attr({
                            class: "ophours_content_separator",
                        });
                        ophours_content_div.append(ophours_content_separator);
                    }
                    let ophours_content_p = $(`<p>${it}</p>`).attr({
                        class: "ophours_content_p",
                    });
                    let ophours_content_sub_div = $("<div>").attr({
                        class: "ophours_content_sub_div",
                    });
                    ophours_content_sub_div.append(ophours_content_p);
                    ophours_content_div.append(ophours_content_sub_div);
                }

                ophours_div.append(ophours_title_div);
                ophours_div.append(ophours_content_div);
                detail_box.append(ophours_div);

                detail_box.append("<br>");
                detail_box.append("<br>");

                let phone_data;
                if (detail_data.formatted_phone_number != undefined) {
                    phone_data = `<p>Phone Number: ${detail_data.formatted_phone_number}</p>`;
                } else {
                    phone_data = `<p>Phone Number: No Data</p>`;
                }
                phone_div.append(phone_data);
                detail_box.append(phone_div);

                // ddeebbuugg!!!!
                //console.log(`The ${hits_i}th item is retrieved: ${detail_data.name}`);
                let website_data;
                if (detail_data.website != undefined) {
                    website_data = `<p class="weblink">Website: <a class="weblink_a" target="_blank" href="${detail_data.website}">Link</a>
      </p>`;
                } else {
                    website_data = `<p>Website: No Data</p>`;
                }
                website_div.append(website_data);
                detail_box.append(website_div);

                let google_reviews_div = $("<div></div>").attr({
                    id: "google_reviews_container",
                });
                google_reviews_div.css("display", "none");

                let native_reviews_container = $("<div></div>").attr({
                    id: "native_reviews_container",
                });
                let google_review_div_toggle_div = $("<div>").attr({
                    id: "google_review_div_toggle_div",
                });
                let native_review_div_toggle_div = $("<div>").attr({
                    id: "native_review_div_toggle_div",
                });
                let google_review_toggle = $(
                    "<button>Show Reviews From Google Maps</button>"
                ).attr({
                    id: "google_review_toggle",
                    class: "btn btn-warning btn-sm btn-radius",
                });
                //

                let post_review_btn = $("<button>Post Review</button>").attr({
                    id: "post_review_btn",
                    class: "btn btn-warning btn-sm btn-radius",
                });

                let native_review_toggle = $(
                    "<button>Show Native Reviews</button>"
                ).attr({
                    id: "google_review_toggle",
                    class: "btn btn-warning btn-sm btn-radius",
                });

                // get native reviews
                if (1) {
                    //empty native review
                    const empty_review_block = $("<div>").attr({
                        id: "empty_review_block",
                        class: "native_review_block",
                    });
                    const empty_review_content_div = $("<div>").attr({
                        class: "empty_review_div",
                    });
                    const empty_review_content_p = $("<p>No review yet.</p>");
                    native_reviews_container.append(empty_review_block);
                    empty_review_block.append(empty_review_content_div);
                    empty_review_content_div.append(empty_review_content_p);
                } else {}

                //
                detail_body.append(native_review_div_toggle_div);
                native_review_div_toggle_div.append(post_review_btn);
                native_review_div_toggle_div.append(native_review_toggle);
                //
                detail_body.append(native_reviews_container);

                detail_body.append(google_review_div_toggle_div);
                google_review_div_toggle_div.append(google_review_toggle);
                detail_body.append(google_reviews_div);
                let review_cnt = 0;
                try {
                    for (r of detail_data.reviews) {
                        let single_review = $("<div></div>").attr({
                            id: `reviews_no_${review_cnt}`,
                            class: "review_box",
                        });
                        google_reviews_div.append(single_review);
                        //
                        single_review.append(`<p>姓名：${r.author_name}</p>`);
                        single_review.append(`<p>評分：${r.rating}</p>`);
                        single_review.append(`<p>評論：${r.text}</p>`);
                        review_cnt++;
                    }
                } catch (err) {
                    console.log("An error occurred while rendering reviews:", err);

                    let single_review = $("<div></div>").attr({
                        id: `reviews_no_${review_cnt}`,
                        class: "review_box",
                    });
                    google_reviews_div.append(single_review);
                    single_review.append(`<p>目前還沒有評論~</p>`);
                }

                //$("#root").append(`<p>${JSON.stringify(hits_arr[i])}</p>`);
                $("#restaurant_skin").hide();
                // $("#restaurant_container").remove();
                // $("#pagination").remove();
                $("#return_result").remove();
                const return_result = $("<div>Return To Search</div>").attr({
                    id: "return_result",
                    class: "nav-item nav-link",
                });
                $("#hide_search").after(return_result);
            });
            $(document).on("click", `#item_img_${hits_i}`, () => {
                $(`#item_title_${hits_i}`).trigger("click");
            });
        }

        $("#trigger_show_signin").click((event) => {
            $("#id_container-login100").show();
        });
        $("#trigger_show_signup").click((event) => {
            $("#id_container-register100").show();
        });
        // let container = $("#filters");
        // container.pagination
        $("body").click((event) => {
            console.log(`${event.target}: oh~oh`);

            if ($("#star-1").is(":checked")) console.log("given star-1");
            if ($("#star-2").is(":checked")) console.log("given star-2");
            if ($("#star-3").is(":checked")) console.log("given star-3");
            if ($("#star-4").is(":checked")) console.log("given star-4");
            if ($("#star-5").is(":checked")) console.log("given star-5");

            if (Date.now() - time_window > 1000) {
                time_window = Date.now();
                click_cnt = 0;
            } else {
                click_cnt++;
                console.log("click cnt:", click_cnt);
            }
            if (click_cnt > 4) {
                const easter_egg = $("<div>").attr({
                    id: "easter_egg",
                });
                const eimg = $("<img>").attr({
                    src: "./images/bonappetit.gif",
                    width: "500px",
                });
                const ebtn = $("<button>OK I AM FULL</button>");
                easter_egg.append(eimg);
                easter_egg.append(ebtn);
                $("#root").append(easter_egg);
                ebtn.click((event) => {
                    $("#easter_egg").remove();
                });
            }

            // 這邏輯真的有夠反人類，我隔天回來看，一直以為我寫錯了
            if ($(event.target).attr("class") === "container-login100") {
                $(".container-login100").hide();
                console.log("!!!!!");
            }
        });
    </script>
</body>

</html>